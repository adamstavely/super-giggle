<mat-card class="result-item-card" [class.menu-open]="showQuickActions">
  <mat-card-content>
    <div class="result-header">
      <div class="result-title-section">
        <mat-icon class="file-type-icon" [title]="result.fileType">
          {{ getFileTypeIcon(result.fileType) }}
        </mat-icon>
        <a [href]="result.url" class="result-title" [attr.aria-label]="'Open ' + result.title">
          {{ result.title }}
        </a>
      </div>
      <div class="result-header-actions">
        <!-- Quick Actions Menu -->
        <button
          mat-icon-button
          class="quick-actions-button"
          (click)="toggleQuickActions()"
          [attr.aria-expanded]="showQuickActions"
          [attr.aria-label]="'Quick actions for ' + result.title"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
        <div class="quick-actions-menu" *ngIf="showQuickActions" (click)="$event.stopPropagation()">
          <button class="menu-action-item" (click)="onOpenQuickView()" *ngIf="supportsPreview">
            <mat-icon>preview</mat-icon>
            <span>Quick View</span>
          </button>
          <button class="menu-action-item" (click)="onDownload()">
            <mat-icon>download</mat-icon>
            <span>Download</span>
          </button>
          <button class="menu-action-item" (click)="onShare()">
            <mat-icon>share</mat-icon>
            <span>Share</span>
          </button>
          <button class="menu-action-item" (click)="onBookmark()">
            <mat-icon>bookmark_border</mat-icon>
            <span>Bookmark</span>
          </button>
          <button class="menu-action-item" (click)="onCopyLink()">
            <mat-icon>link</mat-icon>
            <span>Copy Link</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Enhanced Thumbnail -->
    <div *ngIf="result.thumbnail" class="result-thumbnail-enhanced">
      <img [src]="result.thumbnail" [alt]="result.title" (click)="onOpenQuickView()" *ngIf="supportsPreview" />
      <img [src]="result.thumbnail" [alt]="result.title" *ngIf="!supportsPreview" />
    </div>

    <!-- Enhanced Snippet with highlighting -->
    <div class="result-snippet" [innerHTML]="getEnhancedSnippet()"></div>

    <!-- Document Metadata Card -->
    <div class="metadata-card" *ngIf="documentMetadata && (documentMetadata.fileSize || documentMetadata.wordCount || documentMetadata.readingTime)">
      <div class="metadata-item" *ngIf="documentMetadata.fileSize">
        <mat-icon class="metadata-icon-small">storage</mat-icon>
        <span class="metadata-text-small">{{ formatFileSize(documentMetadata.fileSize) }}</span>
      </div>
      <div class="metadata-item" *ngIf="documentMetadata.wordCount">
        <mat-icon class="metadata-icon-small">text_fields</mat-icon>
        <span class="metadata-text-small">{{ documentMetadata.wordCount | number }} words</span>
      </div>
      <div class="metadata-item" *ngIf="documentMetadata.readingTime">
        <mat-icon class="metadata-icon-small">schedule</mat-icon>
        <span class="metadata-text-small">{{ formatReadingTime(documentMetadata.readingTime) }}</span>
      </div>
      <button
        mat-button
        class="metadata-toggle"
        (click)="toggleMetadata()"
        [attr.aria-expanded]="showMetadata"
      >
        {{ showMetadata ? 'Less' : 'More' }} info
        <mat-icon>{{ showMetadata ? 'expand_less' : 'expand_more' }}</mat-icon>
      </button>
    </div>

    <!-- Expanded Metadata -->
    <div class="expanded-metadata" *ngIf="showMetadata && documentMetadata">
      <div class="metadata-row" *ngIf="documentMetadata.pageCount">
        <span class="metadata-label">Pages:</span>
        <span class="metadata-value">{{ documentMetadata.pageCount }}</span>
      </div>
      <div class="metadata-row" *ngIf="documentMetadata.language">
        <span class="metadata-label">Language:</span>
        <span class="metadata-value">{{ documentMetadata.language }}</span>
      </div>
    </div>

    <div class="result-metadata">
      <div class="metadata-item" *ngIf="result.source">
        <mat-icon class="metadata-icon">folder</mat-icon>
        <span class="metadata-text">{{ result.source }}</span>
      </div>
      <div class="metadata-item" *ngIf="result.author">
        <mat-icon class="metadata-icon">person</mat-icon>
        <span class="metadata-text">{{ result.author }}</span>
      </div>
      <div class="metadata-item" *ngIf="result.lastModified">
        <mat-icon class="metadata-icon">schedule</mat-icon>
        <span class="metadata-text">{{ (result.lastModified | date:'MMM d, y') || '' }}</span>
      </div>
      <div class="metadata-item" *ngIf="result.fileType">
        <mat-icon class="metadata-icon">insert_drive_file</mat-icon>
        <span class="metadata-text">{{ result.fileType.toUpperCase() }}</span>
      </div>
    </div>

    <div *ngIf="result.breadcrumb && result.breadcrumb.length > 0" class="result-breadcrumb">
      <mat-icon class="breadcrumb-icon">chevron_right</mat-icon>
      <span *ngFor="let crumb of result.breadcrumb; let last = last" class="breadcrumb-item">
        {{ crumb }}<span *ngIf="!last" class="breadcrumb-separator"> / </span>
      </span>
    </div>

    <!-- Preview Button -->
    <div class="preview-actions" *ngIf="supportsPreview">
      <button mat-button (click)="onOpenQuickView()" class="preview-button">
        <mat-icon>preview</mat-icon>
        <span>Preview</span>
      </button>
    </div>

    <div class="result-feedback">
      <span class="feedback-label">Was this helpful?</span>
      <button
        mat-button
        class="feedback-button"
        [class.clicked]="helpfulClicked"
        (click)="onHelpfulClick()"
        [disabled]="helpfulClicked || notHelpfulClicked"
        aria-label="Mark as helpful"
      >
        <mat-icon>thumb_up</mat-icon>
        <span>Yes</span>
      </button>
      <button
        mat-button
        class="feedback-button"
        [class.clicked]="notHelpfulClicked"
        (click)="onNotHelpfulClick()"
        [disabled]="helpfulClicked || notHelpfulClicked"
        aria-label="Mark as not helpful"
      >
        <mat-icon>thumb_down</mat-icon>
        <span>No</span>
      </button>
    </div>
  </mat-card-content>
</mat-card>
